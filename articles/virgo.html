<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introducing virgo for interactive exploratory graphics • virgo</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introducing virgo for interactive exploratory graphics">
<meta property="og:description" content="virgo">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">virgo</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/virgo.html">Getting Started</a>
</li>
<li>
  <a href="../articles/gallery/index.html">Example Gallery</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/transition.html">A guide to virgo for ggplot2 users</a>
    </li>
    <li>
      <a href="../articles/selections.html">Using selections to make interactive graphics with virgo</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/vegawidget/vegawidget">
    <span class="fas fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="virgo_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introducing virgo for interactive exploratory graphics</h1>
                        <h4 class="author">Stuart Lee and Earo Wang</h4>
            
      
      
      <div class="hidden name"><code>virgo.Rmd</code></div>

    </div>

    
    
<div id="about-virgo" class="section level1">
<h1 class="hasAnchor">
<a href="#about-virgo" class="anchor"></a>About virgo</h1>
<p>The <strong>virgo</strong> package extends the grammar of interactive graphics based on the <strong>Vega-Lite</strong> library in Javascript, using the design principles of the <strong>tidyverse</strong> suite of packages. It is built on top of the <strong>vegawidget</strong> package, which handles the actual drawing of a <strong>virgo</strong> graphic.</p>
<div id="melbournes-microclimate" class="section level2">
<h2 class="hasAnchor">
<a href="#melbournes-microclimate" class="anchor"></a>Melbourne’s microclimate</h2>
<p>Throughout this vignette we will be exploring three months of microclimate sensor data collected from December 2019 until February 2020 from Melbourne City Council. This data is built into to <strong>virgo</strong> and consists of measurements for things like temperature and relative humidity at 5 different locations across the city.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">virgo</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="va">melbweather</span></code></pre></div>
</div>
<div id="data-encodings-and-marks" class="section level2">
<h2 class="hasAnchor">
<a href="#data-encodings-and-marks" class="anchor"></a>Data, Encodings and Marks</h2>
<p>To construct a visualisation, we begin with tidy data and map columns to visual elements using encodings:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">melbweather</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">date</span> <span class="op">==</span> <span class="st">"2019-12-01"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span>encoding <span class="op">=</span> <span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ambient_temperature</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The data is piped into the <code><a href="../reference/vega.html">vega()</a></code> function and aesthetic mappings are specified with the <code><a href="../reference/enc.html">enc()</a></code>. Valid encodings depend on the <strong>mark</strong> or graphical element being used. As there are no marks for this <strong>virgo</strong> chart, blank canvas is printed. The <code><a href="../reference/vega.html">vega()</a></code> function is required to be called in order to produce a valid visualisation, however as well we see later both data and marks can be specified elsewhere.</p>
<p>To produce interesting charts, we can add <strong>marks</strong> which are visual layers that are added to the chart.</p>
<p>Let’s go back to our data:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">melbweather</span></code></pre></div>
<p>To begin, we will collapse our quarter hourly measurements for each site to hourly averages using <strong>dplyr</strong>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hourly_weather</span> <span class="op">&lt;-</span> <span class="va">melbweather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">site</span>, <span class="va">date</span>, hour_of_day <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/hour.html">hour</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span> <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html">across</a></span><span class="op">(</span>
      <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">ambient_temperature</span><span class="op">:</span><span class="va">pm10</span><span class="op">)</span>, 
      <span class="va">mean</span>, 
      na.rm <span class="op">=</span> <span class="cn">TRUE</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">hourly_weather</span></code></pre></div>
<p>Suppose we are interested in the relationship between ambient temperature and relative humidity. It is theorised that as ambient temperature increases, relative humidity decreases.</p>
<p>We can check whether this is the case with our data by creating a scatter plot.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hourly_weather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span><span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ambient_temperature</span>, y <span class="op">=</span> <span class="va">relative_humidity</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>For users, of <strong>ggplot2</strong> the above incantation should look somewhat familiar. We specify our data at the top level using <code><a href="../reference/vega.html">vega()</a></code> and then add layers using the pipe <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> in combination with marks. Inside the <code><a href="../reference/mark_arc.html">mark_point()</a></code> function we specify the aesthetic mapping or <strong>encoding</strong> that says the x axis should correspond to ambient temperature and the y axis should correspond to relative humidity.</p>
<p>The <strong>virgo</strong> library will automatically add legends depending on the type of encoding and input variable. If we color by a continuous variable a scale is automatically determined and placed on the right hand side of the plot.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hourly_weather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">ambient_temperature</span>, 
      y <span class="op">=</span> <span class="va">relative_humidity</span>, 
      color <span class="op">=</span> <span class="va">wind_speed</span>
    <span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>Likewise, we can evaluate expressions inside of the encoding function, for example, evaluating the month of the date column with <strong>lubridate</strong>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hourly_weather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">ambient_temperature</span>, 
      y <span class="op">=</span> <span class="va">relative_humidity</span>, 
      color <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<p>It appears that there is a slight non-linear and negative relationship between ambient temperature and relative humidity, however, there is a lot over-plotting in the first example, so perhaps it would be best to add some opacity to the previous scatter plot. Graphical elements that don’t depend on columns of the data can be added via extra arguments to the mark function:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hourly_weather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ambient_temperature</span>, y <span class="op">=</span> <span class="va">relative_humidity</span><span class="op">)</span>,
    opacity <span class="op">=</span> <span class="fl">0.1</span>
  <span class="op">)</span></code></pre></div>
<p>Multiple marks can be added to a visualisation by piping a sequence of marks together. We can take our previous scatter plot and draw a loess regression line on top.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">hourly_weather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ambient_temperature</span>, y <span class="op">=</span> <span class="va">relative_humidity</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span>opacity <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"loess"</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span>
<span class="va">p</span></code></pre></div>
<p>Here we’ve specified the encoding at the top level with the <code><a href="../reference/vega.html">vega()</a></code> function, so they are available to all downstream layers. We can have layer specific encodings, by passing the <code><a href="../reference/enc.html">enc()</a></code> to any mark in the sequence. In addition to a single regression line, we could generate separate lines for each measurement within each month of the year:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_smooth</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>color <span class="op">=</span> <span class="fu"><a href="http://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">date</span>, label <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,
    method <span class="op">=</span> <span class="st">"loess"</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="facets" class="section level2">
<h2 class="hasAnchor">
<a href="#facets" class="anchor"></a>Facets</h2>
<p>Sometimes we want to visualise multiple categorical variables at the same time, by creating small multiples (facets) views. Say we were interested in the distribution of wind speed, we could create a histogram:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ws</span> <span class="op">&lt;-</span> <span class="va">hourly_weather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_histogram</a></span><span class="op">(</span><span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wind_speed</span><span class="op">)</span>, bin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>step <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">ws</span></code></pre></div>
<p>How similar are the wind speeds across each measurement site? We can facet by site to find out:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ws</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/facet_views.html">facet_views</a></span><span class="op">(</span>row <span class="op">=</span> <span class="va">site</span><span class="op">)</span></code></pre></div>
<p>Faceting requires specifying a row and/or column encoding, that determines how the subplots are drawn on the canvas. There appears to be a suspiciously large number of records in site “arc1045” that have recorded an average wind speed between 4-5km.</p>
</div>
<div id="multiple-views" class="section level2">
<h2 class="hasAnchor">
<a href="#multiple-views" class="anchor"></a>Multiple Views</h2>
<p>Often it is helpful to place views side by side that shows all of the data rather than subplots like those produced by faceting.</p>
<p><strong>virgo</strong> provides functions to align plots horizontally or vertically with the <code><a href="../reference/hconcat.html">hconcat()</a></code> or <code><a href="../reference/hconcat.html">vconcat()</a></code> functions.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">left</span> <span class="op">&lt;-</span> <span class="va">hourly_weather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span><span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ambient_temperature</span>, y <span class="op">=</span> <span class="va">relative_humidity</span><span class="op">)</span>,
             opacity <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="va">right</span> <span class="op">&lt;-</span> <span class="va">hourly_weather</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span><span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">wind_speed</span>, y <span class="op">=</span> <span class="va">ambient_temperature</span><span class="op">)</span>,
             opacity <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>
<span class="fu"><a href="../reference/hconcat.html">hconcat</a></span><span class="op">(</span><span class="va">left</span>, <span class="va">right</span><span class="op">)</span></code></pre></div>
</div>
<div id="client-side-data-transformations" class="section level2">
<h2 class="hasAnchor">
<a href="#client-side-data-transformations" class="anchor"></a>Client side data transformations</h2>
<p>The <strong>virgo</strong> package exports special functions that are computed directly by <strong>Vega-Lite</strong> rather than R. These functions are prefixed with <code>vg</code>, and are always be called inside of <code><a href="../reference/enc.html">enc()</a></code>.</p>
<p>By using the <code>vg</code> functions, we can get <strong>Vega-Lite</strong> to perform data transformations or aggregations without the use of <strong>tidyverse</strong>. Suppose we were interested in finding out the hour of the day, where the average temperature across all sites reaches its max:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hourly_temp</span> <span class="op">&lt;-</span> <span class="va">melbweather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="fu"><a href="../reference/vg_year.html">vg_hours</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span>, 
      y <span class="op">=</span> <span class="fu"><a href="../reference/vg_sum.html">vg_mean</a></span><span class="op">(</span><span class="va">ambient_temperature</span><span class="op">)</span>
    <span class="op">)</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_line</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">hourly_temp</span></code></pre></div>
<p>In the above code, the <code><a href="../reference/vg_year.html">vg_hours()</a></code> function extract the hour from the date time variable and groups the data within each our block. The y-axis is then average ambient temperature within each hour pooled across all days and sites. We could get a more granular view by using an alternative mark like a boxplot to view the distribution over each hour instead of just the average:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hourly_dist_temp</span> <span class="op">&lt;-</span> <span class="va">melbweather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="fu"><a href="../reference/vg_year.html">vg_hours</a></span><span class="op">(</span><span class="va">date_time</span><span class="op">)</span>, 
      y <span class="op">=</span> <span class="va">ambient_temperature</span>
    <span class="op">)</span>,
    width <span class="op">=</span> <span class="fl">600</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_boxplot</a></span><span class="op">(</span><span class="op">)</span>
<span class="va">hourly_dist_temp</span></code></pre></div>
<p>Generally, we believe it is best to perform data transformations outside of the visualisation environment as the transformations are explicit (i.e. when using the <strong>tidyverse</strong>). However, as we will see later these client side transformations become especially useful when combined with interactivity.</p>
</div>
<div id="interactivity-via-selections" class="section level2">
<h2 class="hasAnchor">
<a href="#interactivity-via-selections" class="anchor"></a>Interactivity via selections</h2>
<p>Selections are how a <strong>virgo</strong> graphic defines interactions, and are strongly influenced by the <strong>Vega-Lite</strong> javascript API. There are several types of selection, but to begin we will create an interval selection:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_single.html">select_interval</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>By default, an interval selection will specify a rectangular region, that is generated by dragging the mouse over the view. Each mark can accept a selection object, which will filter the data when the region is active:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">hourly_weather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ambient_temperature</span>, y <span class="op">=</span> <span class="va">relative_humidity</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span>opacity <span class="op">=</span> <span class="fl">0.1</span>, selection <span class="op">=</span> <span class="va">selection</span><span class="op">)</span> 
<span class="va">p</span></code></pre></div>
<p>If you just want to draw the selection without performing the filter, you can specify it as an identity selection</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">hourly_weather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ambient_temperature</span>, y <span class="op">=</span> <span class="va">relative_humidity</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span>opacity <span class="op">=</span> <span class="fl">0.1</span>, selection <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">selection</span><span class="op">)</span><span class="op">)</span> 
<span class="va">p</span></code></pre></div>
<p>Rather than filtering the data, you may want to conditionally encode a visual element based on whether data falls into a selection. The <code><a href="../reference/encode_if.html">encode_if()</a></code> function allows an encoding to depend on one (or more) selections. We could rewrite the above plot so the points that fall inside of the selection are given an opacity of 0.5, while those outside are given an opacity of 0.1.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">hourly_weather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ambient_temperature</span>, y <span class="op">=</span> <span class="va">relative_humidity</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>opacity <span class="op">=</span> <span class="fu"><a href="../reference/encode_if.html">encode_if</a></span><span class="op">(</span><span class="va">selection</span>, <span class="fl">0.5</span>, <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span> 
<span class="va">p</span></code></pre></div>
<p>Instead of using values, the conditional encoding can depend on a variable instead:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">hourly_weather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ambient_temperature</span>, y <span class="op">=</span> <span class="va">relative_humidity</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>
      color <span class="op">=</span> <span class="fu"><a href="../reference/encode_if.html">encode_if</a></span><span class="op">(</span><span class="va">selection</span>, <span class="va">wind_speed</span> <span class="op">&gt;</span> <span class="fl">10</span>, <span class="st">"grey"</span><span class="op">)</span>,
      opacity <span class="op">=</span> <span class="fu"><a href="../reference/encode_if.html">encode_if</a></span><span class="op">(</span><span class="va">selection</span>, <span class="fl">0.5</span>, <span class="fl">0.01</span><span class="op">)</span>
      <span class="op">)</span>
  <span class="op">)</span> 
<span class="va">p</span></code></pre></div>
<p>Interval selections can be restricted to a single axis, so a brush only moves in one direction. The following produces a line plot of the maximum daily temperature, with a brush over the x-axis</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x_selection</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/select_single.html">select_interval</a></span><span class="op">(</span>encodings <span class="op">=</span> <span class="st">"x"</span><span class="op">)</span>

<span class="va">overview</span> <span class="op">&lt;-</span> <span class="va">melbweather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">date</span>,
      y <span class="op">=</span> <span class="fu"><a href="../reference/vg_sum.html">vg_max</a></span><span class="op">(</span><span class="va">ambient_temperature</span><span class="op">)</span>
    <span class="op">)</span>,
    width <span class="op">=</span> <span class="fl">600</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span>
    selection <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html">I</a></span><span class="op">(</span><span class="va">x_selection</span><span class="op">)</span>
  <span class="op">)</span>
<span class="va">overview</span></code></pre></div>
<p>Interval selections can also be bound to a scale and then composed with another view to produce a zooming effect. After concatenating the two views, dragging the x-axis on the bottom graphic will zoom in on the top view:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">context</span> <span class="op">&lt;-</span> <span class="va">melbweather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span>
    <span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>
      x <span class="op">=</span> <span class="va">date</span>,
      y <span class="op">=</span> <span class="fu"><a href="../reference/vg_sum.html">vg_max</a></span><span class="op">(</span><span class="va">ambient_temperature</span><span class="op">)</span>
    <span class="op">)</span>,
    width <span class="op">=</span> <span class="fl">600</span>,
    height <span class="op">=</span> <span class="fl">200</span>
  <span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/scale_x.html">scale_x</a></span><span class="op">(</span>name <span class="op">=</span> <span class="cn">NULL</span>, domain <span class="op">=</span> <span class="va">x_selection</span><span class="op">)</span>

<span class="fu"><a href="../reference/hconcat.html">vconcat</a></span><span class="op">(</span><span class="va">context</span>, <span class="va">overview</span><span class="op">)</span></code></pre></div>
<p>Selections can also be used to filter data in multi-view plots. For example we could view the trail of temperature measurements that each site recorded over the highlighted period in the overview plot.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">active_sensor</span> <span class="op">&lt;-</span> <span class="va">melbweather</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/vega.html">vega</a></span><span class="op">(</span><span class="fu"><a href="../reference/enc.html">enc</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ambient_temperature</span>, y <span class="op">=</span> <span class="va">site</span><span class="op">)</span>, height <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="../reference/mark_arc.html">mark_tick</a></span><span class="op">(</span>selection <span class="op">=</span> <span class="va">x_selection</span><span class="op">)</span> 
<span class="fu"><a href="../reference/hconcat.html">vconcat</a></span><span class="op">(</span><span class="va">overview</span>, <span class="va">active_sensor</span><span class="op">)</span></code></pre></div>
<p>This is just the beginning of what is possible to achieve with selections, for more detail see the selections vignette.</p>
</div>
<div id="sizing-and-saving" class="section level2">
<h2 class="hasAnchor">
<a href="#sizing-and-saving" class="anchor"></a>Sizing and saving</h2>
<p>The sizing of a plot is controlled inside the <code><a href="../reference/vega.html">vega()</a></code> function with the height and width arguments. These arguments refer to the pixel dimensions of the view.</p>
<p><strong>virgo</strong> graphics can be saved with the <strong>vegawidget</strong> package using the <code>vg_write_png()</code> or <code>vg_write_svg()</code> functions.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Earo Wang, Stuart Lee.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
